---
title: 'Traefik als Grundgerüst der Anleitungen'
description: 'Yopass ist eine Open-Source-Plattform zur sicheren und schnellen Übermittlung vertraulicher Daten.'
date: 2024-10-05
tags: ['reverse-proxy', 'opensource', 'ssl', 'traefik']
image: './traefik.png'
authors: ['tobias']
---

## 1. Was ist ein Reverse Proxy, und warum Traefik?

Ein Reverse Proxy ist ein Server, der eingehenden Traffic von Clients entgegennimmt und an Backend-Dienste weiterleitet. Dadurch werden Vorteile wie:

- Lastverteilung
- SSL/TLS-Verschlüsselung
- Routing basierend auf Hostnamen oder Pfaden
- Zentrale Verwaltung mehrerer Dienste 

Traefik sticht dabei hervor, da es speziell für dynamische, containerisierte Umgebungen wie Docker entwickelt wurde. Es unterstützt automatische Service-Erkennung und ist einfach zu konfigurieren.

---

## 2. Voraussetzungen

Bevor wir starten, stellt sicher, dass folgende Voraussetzungen erfüllt sind:

1. **Docker** ist installiert ([Docker installieren](https://docs.docker.com/get-docker/)).
2. **Docker Compose** ist installiert ([Docker Compose installieren](https://docs.docker.com/compose/install/)).
3. Grundkenntnisse in Docker und Linux-Terminals sind vorhanden.

---

## 3. Projektverzeichnis erstellen

Beginnen wir damit, ein Projektverzeichnis zu erstellen, in dem alle Konfigurationsdateien liegen:

```bash
mkdir traefik-docker-setup
cd traefik-docker-setup
mkdir config
touch config/traefik.yaml
```

---

## 4. `docker-compose.yml` erstellen

Erstellt eine neue Datei namens `docker-compose.yml` mit folgendem Inhalt:

```shell
nano docker-compose.yml
```

```yaml title="docker-compose.yml"
---
services:
  traefik:
    image: docker.io/library/traefik:v3.2.3
    container_name: traefik
    ports:
      - 80:80
      - 443:443
      # --> (Optional) Enable Dashboard, don't do in production
      - 8080:8080
      # <--
    volumes:
      - /run/docker.sock:/run/docker.sock:ro
      - ./config/traefik.yaml:/etc/traefik/traefik.yaml:ro
      - ./data/certs/:/var/traefik/certs/:rw
      - ./config/conf.d/:/etc/traefik/conf.d/:ro
    environment:
      - CF_DNS_API_TOKEN=${CF_DNS_API_TOKEN} # <-- Change this to your Cloudflare API Token
    networks:
      - frontend
    restart: unless-stopped
networks:
  frontend:
    external: true # <-- (Optional) Change this to false if you want to create a new network
```

Diese Datei definiert den Traefik-Service und seine Konfiguration. Die **Docker-Socket**-Verbindung erlaubt Traefik, automatisch Dienste zu erkennen, die mit Docker laufen.

---

## 5. Netzwerk erstellen

Traefik benötigt ein Docker-Netzwerk, um mit anderen Diensten zu kommunizieren. Erstellt das Netzwerk mit folgendem Befehl:

```bash
docker network create frontend
```

---

## 6. `traefik.yaml` erstellen

```shell
nano config/traefik.yaml
```

```yaml title="traefik.yaml"
global:
  checkNewVersion: false
  sendAnonymousUsage: false

# --> (Optional) Change log level and format here ...
#     - level: [TRACE, DEBUG, INFO, WARN, ERROR, FATAL]
# log:
#  level: ERROR
# <--

# --> (Optional) Enable accesslog here ...
# accesslog: {}
# <--

# --> (Optional) Enable API and Dashboard here, don't do in production
api:
  dashboard: true
  insecure: true
# <--

# -- Change EntryPoints here...
entryPoints:
  web:
    address: :80
    # --> (Optional) Redirect all HTTP to HTTPS
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
    # <--
  websecure:
    address: :443

# -- Configure your CertificateResolver here...
certificatesResolvers:
  cloudflare:
    acme:
      email: deinemail@domain.de  # <-- Change this to your email
      storage: /var/traefik/certs/cloudflare-acme.json
      caServer: "https://acme-v02.api.letsencrypt.org/directory"
      dnsChallenge:
        provider: cloudflare # <-- (Optional) Change this to your DNS provider
        resolvers:
          - "1.1.1.1:53"
          - "8.8.8.8:53"

# --> (Optional) Disable TLS Cert verification check
# serversTransport:
#   insecureSkipVerify: true
# <--

providers:
  docker:
    exposedByDefault: false  # <-- (Optional) Change this to true if you want to expose all services
  file:
    directory: /etc/traefik
    watch: true
```

---

## 7. `.env` anlegen 

```shell
nano .env
```

```env title=".env"
CF_DNS_API_TOKEN = 'cloudflare api token'
```

## 8. Traefik starten

Startet Traefik mit dem Befehl:

```bash
docker-compose up -d
```

Nach wenigen Sekunden sollte Traefik laufen. Ihr könnt das Dashboard über `http://<eure-ip>:8080` erreichen. (Das Dashboard ist in dieser Konfiguration nicht gesichert und sollte in der Produktion deaktiviert oder geschützt werden.)

---


