---
title: 'Traefik mit Docker Compose installieren'
description: 'Traefik ist ein moderner Reverse Proxy, perfekt für containerisierte Umgebungen. Automatische Service-Erkennung & einfache Konfiguration.'
date: 2024-12-17
tags: ['reverse-proxy', 'opensource', 'ssl', 'traefik']
image: './traefik.png'
authors: ['tobias']
---

## 1. Was ist ein Reverse Proxy, und warum Traefik?

Als Reverse Proxy nutze ich gerne Traefik. Es sticht besonders hervor, da es speziell für dynamische, containerisierte Umgebungen wie Docker entwickelt wurde. Traefik unterstützt die automatische Service-Erkennung und ist einfach zu konfigurieren.

Ein Reverse Proxy fungiert als Vermittler zwischen Clients (z. B. Webbrowsern) und Servern. Er leitet Anfragen der Clients an die richtigen Server weiter, verwaltet Lastverteilung, sichert die Kommunikation mit SSL/TLS

---

## 2. Voraussetzungen

Bevor wir starten, stellt sicher, dass folgende Voraussetzungen erfüllt sind:

1. **Docker** ist installiert ([Docker installieren](https://docs.docker.com/get-docker/)).
2. **Docker Compose** ist installiert ([Docker Compose installieren](https://docs.docker.com/compose/install/)).
3. Grundkenntnisse in Docker und Linux-Terminals sind vorhanden.

---

## 3. Projektverzeichnis erstellen

Beginnen wir damit, ein Projektverzeichnis zu erstellen, in dem alle Konfigurationsdateien liegen:

```bash
mkdir /opt/containers/traefik/config
cd /opt/containers/traefik
```

---

## 4. `docker-compose.yml` erstellen

Erstellt eine neue Datei namens `docker-compose.yml` mit folgendem Inhalt:

```shell
nano docker-compose.yml
```

```yaml title="docker-compose.yml"
---
services:
  traefik:
    image: docker.io/library/traefik:v3.2.3
    container_name: traefik
    ports:
      - 80:80
      - 443:443
      # --> (Optional) aktiviere dashboard, don't do in production
      - 8080:8080
      # <--
    volumes:
      - /run/docker.sock:/run/docker.sock:ro
      - ./config/traefik.yaml:/etc/traefik/traefik.yaml:ro
      - ./data/certs/:/var/traefik/certs/:rw
      - ./config/conf.d/:/etc/traefik/conf.d/:ro
    environment:
      - CF_DNS_API_TOKEN=${CF_DNS_API_TOKEN} 
    networks:
      - frontend
    restart: unless-stopped
networks:
  frontend:
    external: true 
```

Diese Datei definiert den Traefik-Service und seine Konfiguration. Die **Docker-Socket**-Verbindung erlaubt Traefik, automatisch Dienste zu erkennen, die mit Docker laufen.

---

## 5. Netzwerk erstellen

Traefik benötigt ein Docker-Netzwerk, um mit anderen Diensten zu kommunizieren. Erstellt das Netzwerk mit folgendem Befehl:

```bash
docker network create frontend
```

---

## 6. `traefik.yaml` erstellen

```shell
nano config/traefik.yaml
```

```yaml title="traefik.yaml"
global:
  checkNewVersion: false
  sendAnonymousUsage: false
# --> (Optional) aktiviere API und Dashboard hier, don't do in production
#api:
#  dashboard: true
#  insecure: true
# --> (Optional) Zum Testen kannst du die Kommentierung entfernen.
entryPoints:
  web:
    address: :80
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
  websecure:
    address: :443

certificatesResolvers:
  cloudflare:
    acme:
      email: deine@mail.com  # <-- deine cloudflare mail adresse
      storage: /var/traefik/certs/cloudflare-acme.json
      caServer: "https://acme-v02.api.letsencrypt.org/directory"
      dnsChallenge:
        provider: cloudflare 
        resolvers:
          - "1.1.1.1:53"
          - "8.8.8.8:53"


providers:
  docker:
    exposedByDefault: false 
  file:
    directory: /etc/traefik
    watch: true
```

---

## 7. `.env` anlegen 

```shell
nano .env
```

```env title=".env"
CF_DNS_API_TOKEN = 'cloudflare api token'
```

Für das API-Token benötigt ihr einen kostenlosen Cloudflare-Account. Zudem müsst ihr entweder die Nameserver von Cloudflare verwenden, die komplette Domain von Cloudflare verwalten lassen oder die Domain direkt bei Cloudflare registrieren.

Das API-Token benötigt die Berechtigung `Zone > DNS > Edit`.

## 8. Traefik starten

Startet Traefik mit dem Befehl:

```bash
docker-compose up -d
```

Nach wenigen Sekunden sollte Traefik laufen. Ihr könnt das Dashboard über `http://<eure-ip>:8080` erreichen. (Das Dashboard ist in dieser Konfiguration nicht gesichert und sollte in der Produktion deaktiviert oder geschützt werden.)

---


